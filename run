#!/bin/bash

# Requirements: 
# (1) Virutalbox needs to be installed (make sure you have at least 20gb of disk space) 
# (2) Minikube needs to be installed (brew install minikube) 

minikube start --disk-size=20g--vm-driver=virtualbox

eval $(minikube docker-env)

git clone https://github.com/ResearchAdvancingFuzzing/gtfo.git

docker build -t init:v1 -f fuzzing-manager/init/Dockerfile .
docker build -t gtfo-source:v1 -f fuzzing-manager/gtfo-source/Dockerfile .
docker build -t seed-corpus:v1 -f fuzzing-manager/seed-corpus/Dockerfile .
docker build -t coverage:v1 -f fuzzing-manager/coverage/Dockerfile .
docker build -t target:v1 -f fuzzing-manager/target/Dockerfile .
docker build -t spitfire:v1 .
docker build -t fuzz:v1 -f spitfire/tools/mutfuzz/Dockerfile .
docker build -t init:v1 -f fuzzing-manager/init/Dockerfile .
docker build -t knowledge-base:v1 -f spitfire/knowledge-base/Dockerfile .

# This job needs to be created "after" but for now this will do
kubectl apply -f config-init.yaml 
kubectl apply -f config-jobs.yaml #config.yaml 
